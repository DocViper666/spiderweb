function findCountry(t,a){for(var e=0;e<t.length;e++)if(t[e].WPX==a)return t[e]}function buildHtmlTable(t,a,e,s,n){var l=new Array,p=new Date,r="00"+p.getUTCDate();r=r.substring(r.length-2,r.length);var o="00"+(Number(p.getUTCMonth())+1);o=o.substring(o.length-2,o.length);var c=p.getUTCFullYear();dt_current=r+"/"+o+"/"+c,$(t).empty();for(var i=0;i<a.length;i++){l[i]=a[i].rowid;var d=$('<tr id="'+a[i].rowid+'"/>'),g=e.find(t=>t==a[i].rowid);null!=n?n==a[i].de?d=$('<tr class="table-success" id="'+a[i].rowid+'"/>'):n==a[i].dx&&(d=$('<tr class="table-info" id="'+a[i].rowid+'"/>')):null==g&&e.length>0&&(d=$('<tr class="table-info" id="'+a[i].rowid+'"/>'));var m=findCountry(s,a[i].spotdxcc);a[i].de==n?de="<b>"+a[i].de+"</b>":de=a[i].de,d.append($("<td/>").html('<a href="https://www.qrz.com/db/'+a[i].de+'" target="_blank" rel="noopener"><i class="search" aria-label="'+a[i].de+'"></i></a><span>&nbsp'+de+"</span></b>"));var h=Intl.NumberFormat("it-IT",{style:"decimal"}).format(a[i].freq);d.append($("<td/>").html('<span class="badge bg-warning text-dark badge-responsive">'+h+"</span>")),a[i].dx==n?dx="<b>"+a[i].dx+"</b>":dx=a[i].dx,d.append($("<td/>").html('<a href="https://www.qrz.com/db/'+a[i].dx+'" target="_blank" rel="noopener"><i class="search" aria-label="'+a[i].dx+'"></i></a><span>&nbsp'+dx+"</span>"));try{d.append($("<td/>").html('<a href="#" data-toggle="tooltip" title="'+m.country+'"><img class="img-flag" src="https://www.countryflags.io/'+m.ISO+'/shiny/32.png" alt="'+m.country+'"></a>'))}catch(t){d.append($("<td/>"))}d.append($('<td class="d-none d-lg-table-cell d-xl-table-cell"/>').html(m.country)),d.append($('<td class="d-none d-lg-table-cell d-xl-table-cell"/>').html(a[i].comm));var u=new Date(1e3*a[i].time),b="00"+u.getUTCHours();b=b.substring(b.length-2,b.length);var _="00"+u.getMinutes();_=_.substring(_.length-2,_.length);var f="00"+u.getUTCDate();f=f.substring(f.length-2,f.length);var v="00"+(Number(u.getUTCMonth())+1);v=v.substring(v.length-2,v.length);var y=u.getUTCFullYear();tm=b+":"+_,(u=f+"/"+v+"/"+y)==dt_current?d.append($("<td/>").html(tm)):d.append($("<td/>").html('<table class="table-sm table-borderless"><tbody><tr style="background-color:transparent"><td>'+tm+"</td></tr><tr><td>"+u+"</td></tr></tbody></table>")),$(t).append(d)}try{return Array.from(l)}catch(t){return}}function mySearch(t){t.preventDefault(),myTimer()}function myTimer(){var t=new XMLHttpRequest;selectedBands=[].map.call(document.getElementById("band").selectedOptions,t=>t.value),selectedDEre=[].map.call(document.getElementById("de_re").selectedOptions,t=>t.value),selectedDXre=[].map.call(document.getElementById("dx_re").selectedOptions,t=>t.value);var a="",e="";selectedBands.length<14&&(a=selectedBands.map(function(t,a){return"b="+t}).join("&"));var s="";selectedDEre.length<7&&(s=selectedDEre.map(function(t,a){return"e="+t}).join("&")),e=a&&s?a.concat("&".concat(s)):a.concat(s);var n="";selectedDXre.length<7&&(n=selectedDXre.map(function(t,a){return"x="+t}).join("&"));var l="spotlist";(e=e&&n?e.concat("&".concat(n)):e.concat(n))&&(l=l.concat("?".concat(e))),t.open("GET",l,!0),t.onload=function(){try{rows_list=buildHtmlTable("#bodyspot",JSON.parse(this.response),rows_list,my_countries.country_codes)}catch(t){console.log(this.response)}},t.send()}function buildHtmlPlots(t,a){$(t).empty();var e=$('<div class="container justify-content-center"/>');e.append($('<h3  class="text-center"/>').html("Band Activity")),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_AF+'.png" alt="propatation heatmap AF" srcset="/static/plots/'+a.propagation_heatmaps_AF+'.svg">')),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_AN+'.png" alt="propatation heatmap AN" srcset="/static/plots/'+a.propagation_heatmaps_AN+'.svg">')),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_AS+'.png" alt="propatation heatmap AF" srcset="/static/plots/'+a.propagation_heatmaps_AF+'.svg">')),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_EU+'.png" alt="propatation heatmap EU" srcset="/static/plots/'+a.propagation_heatmaps_EU+'.svg">')),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_NA+'.png" alt="propatation heatmap NA" srcset="/static/plots/'+a.propagation_heatmaps_NA+'.svg">')),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_OC+'.png" alt="propatation heatmap OC" srcset="/static/plots/'+a.propagation_heatmaps_OC+'.svg">')),e.append($('<img class="img-fluid" src="/static/plots/'+a.propagation_heatmaps_SA+'.png" alt="propatation heatmap SA" srcset="/static/plots/'+a.propagation_heatmaps_SA+'.svg">')),$(t).append(e),$(t).append($("<hr>"));var s=$('<div class="container justify-content-center"/>');s.append($('<img class="img-fluid" src="/static/plots/'+a.qso_months+'.png" alt="Qso per months" srcset="/static/plots/'+a.qso_months+'.svg">')),$(t).append(s)}function plotsTimer(){var t=new XMLHttpRequest;t.open("GET","plotlist",!0),t.onload=function(){try{plot_list=buildHtmlPlots("#plotlist",JSON.parse(this.response))}catch(t){console.log(t),console.log(this.response)}},t.send()}function myCallsignSearch(){callsign=document.getElementById("callsignInput").value,callsign.replace(/\s/g,"").length>0&&(location.href="/callsign.html?c=".concat(callsign.trim().toUpperCase()))}