<!DOCTYPE html>
<html>
	<head>
	<title>DX Cluster from IU1BOW</title>
	<meta charset="utf-8">
	<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.png') }}">  
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
	<script type="application/javascript" src="/static/js/jquery.min.js"></script>

	<script>
	var initial_data= {{payload|tojson|safe}};
	var rows_list = new Array();
// Builds tve HTML Table out of myList.
function buildHtmlTable(selector,data,rl) {
	//rows

	var myRows=new Array();

	$(selector).empty();
	for (var i = 0; i < data.length; i++) {
                myRows[i]=data[i].rowid;
		var row$;	
		row$=$('<tr/>');
		let found = rl.find(element => element ==data[i].rowid);
		if ( found == undefined && rl.length > 0) {
			row$=$('<tr class="table-info"/>');
		};
		row$.append($('<td/>').html('<a href="https://www.qrz.com/db/'+data[i].de+ '" target="_blank"><i class="fas fa-search"></i></a><span>&nbsp'+data[i].de+'</span>'));
		var freq = data[i].freq.toString().replace(/\./gi, ",");
		row$.append($('<td/>').html(freq));
		row$.append($('<td/>').html('<a href="https://www.qrz.com/db/'+data[i].dx+ '" target="_blank"><i class="fas fa-search"></i></a><span>&nbsp'+data[i].dx+'</span>'));
		row$.append($('<td/>').html(data[i].comm));
		var dt=new Date(data[i].time * 1000);
		var hh='00'+dt.getUTCHours();
		hh=hh.substring(hh.length - 2, hh.length); 
		var mi='00'+dt.getMinutes();
		mi=mi.substring(mi.length - 2, mi.length);
		var dd='00'+dt.getDate();
		dd=dd.substring(dd.length - 2, dd.length);
		var mo='00'+(Number(dt.getUTCMonth())+1);
		mo=mo.substring(mo.length - 2, mo.length);
		var yy=dt.getUTCFullYear();
		dt=hh+':'+mi+' '+dd+'/'+mo+'/'+yy;
		row$.append($('<td/>').html(dt));
      		$(selector).append(row$);
    	}
	return Array.from(myRows);
}


	</script>

	</head>
	<body>
	<!---
	<body onLoad="row_list=buildHtmlTable('#bodyspot',initial_data, rows_list)">
	-->
		<div class="container" id="header">
			<h1>WEB DX Cluster For HAM Radio IU1BOW-2</h1>
			Telnet access: <a href="telnet://dxcluster.iu1bow.it:7300">dxcluster.iu1bow.it 7300</a><br>
	For connect your cluster node, write to	<a href="mailto:corrado.gerbaldo@gmail.com?Subject=Connect%20my%20DxCluster%20node" target="_top">corrado.gerbaldo@gmail.com</a>
		</div>
		<div class="container" id="results">
	 	<table 	id="spotsTable"
			class="table table-striped table-condensed" >
			<thead>
				<th>DX De</th>
				<th>Freq</th>
				<th>DX</th>
				<th>Comments</th>
				<th>UTC Time</th>
			</thead>
			<tbody id="bodyspot">
			</tbody>
	   	 </table>
		
			<script>
			 	rows_list=buildHtmlTable('#bodyspot',initial_data, rows_list);
				var myRefresh = setInterval(myTimer, 30000);
				function myTimer() {
					var request = new XMLHttpRequest()

					// Open a new connection, using the GET request on the URL endpoint
					request.open('GET', 'spotlist', true)
					request.onload = function() 		{
						rows_list=buildHtmlTable('#bodyspot',JSON.parse(this.response),rows_list );
	   				}
					request.send()
				}
			</script>

		</div>
	</body>

</html>
