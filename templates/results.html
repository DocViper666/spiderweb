<!DOCTYPE html>
<html>
	<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script>
	var myList = {{payload|tojson|safe}};
// Builds tve HTML Table out of myList.
function buildHtmlTable(selector,data) {
	//rows

	$(selector).empty();
	for (var i = 0; i < myList.length; i++) {
		var row$;	
		
		row$=$('<tr/>');
		row$.append($('<td/>').html(data[i].de));
		var freq = myList[i].freq.toString().replace(/\./gi, ",");
		row$.append($('<td/>').html(freq));
		row$.append($('<td/>').html(data[i].dx));
		row$.append($('<td/>').html(data[i].comm));
		var dt=new Date(data[i].time * 1000);
		var hh='00'+dt.getUTCHours();
		hh=hh.substring(hh.length - 2, hh.length); 
		var mi='00'+dt.getMinutes();
		mi=mi.substring(mi.length - 2, mi.length);
		var dd='00'+dt.getDate();
		dd=dd.substring(dd.length - 2, dd.length);
		var mo='00'+dt.getUTCMonth()+1;
		mo=mo.substring(mo.length - 2, mo.length);
		var yy=dt.getUTCFullYear();
		dt=hh+':'+mi+' '+dd+'/'+mo+'/'+yy;
		row$.append($('<td/>').html(dt));
      		$(selector).append(row$);
    	}
}


	</script>

	</head>
	<body onLoad="buildHtmlTable('#bodyspot',myList)">
		<div class="container" id="header">
			<h1>WEB DX Cluster For HAM Radio IU1BOW-2</h1>
			Telnet access: <a href="telnet://dxcluster.iu1bow.it:7300">dxcluster.iu1bow.it 7300</a><br>
	For connect your cluster node, write to	<a href="mailto:corrado.gerbaldo@gmail.com?Subject=Connect%20my%20DxCluster%20node" target="_top">corrado.gerbaldo@gmail.com</a>
		</div>
		<div class="container" id="time">
			<a href="https://time.is/UTC" id="time_is_link" rel="nofollow" style="font-size:18px">UTC Time:</a>
			<span id="UTC_za00" style="font-size:18px"></span>
			<script src="//widget.time.is/t.js"></script>
			<script>
				time_is_widget.init({UTC_za00:{time_format:"hours:minutes"}});

				var myRefresh = setInterval(myTimer, 30000);
				function myTimer() {
					var request = new XMLHttpRequest()

					// Open a new connection, using the GET request on the URL endpoint
					request.open('GET', 'spotlist', true)
					request.onload = function() 		{
						buildHtmlTable('#bodyspot',JSON.parse(this.response) );
	   				}
					request.send()
				}
			</script>
		</div>
		<div class="container" id="results">
	 	<table 	id="spotsTable"
			class="table table-striped table-condensed" >
			<thead>
				<th>DX De</th>
				<th>Freq</th>
				<th>DX</th>
				<th>Comments</th>
				<th>UTC Time</th>
			</thead>
			<tbody id="bodyspot">
			</tbody>
	   	 </table>
		
		</div>
	</body>

</html>
